name: Example Workflow

on:
  workflow_dispatch:
    inputs:
      env_pair:
        description: 'Comma-separated environment variable pairs, e.g., dev=blue,dev=green'
        required: true
        default: 'dev=blue,dev=green'

jobs:
  run-workflow:
    runs-on: ubuntu-latest
    env:
      ENV_PAIR: ${{ github.event.inputs.env_pair }}
      domain: xyz.com
      rg: new
      container: hello

    steps:
      - name: Parse and set environment variables
        id: set-env
        run: |
          IFS=',' read -ra PAIRS <<< "${{ env.ENV_PAIR }}"
          for pair in "${PAIRS[@]}"; do
            IFS="=" read -r env_name env_value <<< "$pair"
            echo "$env_name=$env_value" >> $GITHUB_ENV
            echo "::set-output name=${env_name}_${env_value}::${env_name}=${env_value}"
          done

      - name: Print environment variables
        run: |
          IFS=',' read -ra PAIRS <<< "${{ env.ENV_PAIR }}"
          for pair in "${PAIRS[@]}"; do
            IFS="=" read -r env_name env_value <<< "$pair"
            echo "Environment variable $env_name is ${!env_name}"
          done

      - name: Set dynamic environment variables
        run: |
          IFS=',' read -ra PAIRS <<< "${{ env.ENV_PAIR }}"
          for pair in "${PAIRS[@]}"; do
            IFS="=" read -r env_name env_value <<< "$pair"
            echo "domain=${env_name}-${env_value}.${domain}" >> $GITHUB_ENV
            echo "rg=${env_name}-${env_value}.${rg}" >> $GITHUB_ENV
          done

      - name: Run tasks based on environments
        run: |
          IFS=',' read -ra PAIRS <<< "${{ env.ENV_PAIR }}"
          for pair in "${PAIRS[@]}"; do
            IFS="=" read -r env_name env_value <<< "$pair"
            echo "Running task for environment: $env_name=$env_value"
            # Add steps to run for each environment
          done
